counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
# Load school report card data (non-spatial)
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
### 2.1 Load shapefile
####Load shapefile (spatial data)
counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
### 2.2 Load CSV
####Load school report card data (non-spatial)
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
### 2.3 Filter Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
### 2.4 Convert numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(Count of Students Expected to Test),
## 3. Summary by county
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(sf)
library(tidyverse)
library(readxl)
library(tmap)
### 2.1 Load shapefile
####Load shapefile (spatial data)
counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
### 2.2 Load CSV
####Load school report card data (non-spatial)
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
### 2.3 Filter Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
### 2.4 Convert numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(Count of Students Expected to Test),
## 3. Summary by county
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
county_summary <- county_summary %>%
mutate(County = toupper(County))
counties <- counties %>%
mutate(COUNTY = toupper(COUNTY))
## Compute Washington state average
state_avg <- county_summary %>%
summarise(state_avg = mean(avg_percent_met, na.rm = TRUE)) %>%
pull(state_avg)
state_avg
h2_joined <- counties %>%
left_join(county_summary, by = c("COUNTY" = "County"))
h2_final <- h2_joined %>%
mutate(
comparison = case_when(
is.na(avg_percent_met)              ~ "No data",
avg_percent_met >  state_avg        ~ "Above state average",
avg_percent_met <  state_avg        ~ "Below state average",
TRUE                                ~ "Equal to state average"
)
)
h2_final %>%
st_drop_geometry() %>%
select(COUNTY, avg_percent_met, comparison) %>%
head()
tmap_mode("plot")
tm_shape(h2_final) +
tm_polygons(
col = "avg_percent_met",
palette = "YlGnBu",
title = "% met standard"
) +
tm_layout(
title = "Science achievement by county\nrelative to Washington state average"
)
### 2.1 Load shapefile
####Load shapefile (spatial data)
counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
### 2.2 Load CSV
####Load school report card data (non-spatial)
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
### 2.3 Filter Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
### 2.4 Convert numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(`Count of Students Expected to Test`),
met = as.numeric(CountMetStandard)
)
### 2.1 Load shapefile
####Load shapefile (spatial data)
counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
### 2.2 Load CSV
####Load school report card data (non-spatial)
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
### 2.3 Filter Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
### 2.4 Convert numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(`Count of Students Expected to Test`),
met = as.numeric(CountMetStandard)
)
names(assessment_science)[18:25]   # Check new column
summary(assessment_science$expected)
summary(assessment_science$met)
## 3. Summary by county
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
# Check example result
head(county_summary)
## 3. Summary by county
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
# Check example result
head(county_summary)
county_summary <- county_summary %>%
mutate(County = toupper(County))
counties <- counties %>%
mutate(COUNTY = toupper(COUNTY))
## Compute Washington state average
state_avg <- county_summary %>%
summarise(state_avg = mean(avg_percent_met, na.rm = TRUE)) %>%
pull(state_avg)
state_avg
county_summary <- county_summary %>%
mutate(County = toupper(County))
counties <- counties %>%
mutate(COUNTY = toupper(COUNTY))
## Compute Washington state average
state_avg <- county_summary %>%
summarise(state_avg = mean(avg_percent_met, na.rm = TRUE)) %>%
pull(state_avg)
state_avg
# read
report <- read_csv(here::here("homework_2",
"Report_Card_Assessment_Data_2018-19_School_Year.csv"),
na= "NULL")
# read
report <- read_csv(here::here("homework_2",
"Report_Card_Assessment_Data_2018-19_School_Year.csv"),
na= "NULL")
Datatypelist <- report %>%
summarise_all(class) %>%
pivot_longer(everything(),
names_to="All_variables",
values_to="Variable_class")
state_average <- county_only%>%
summarise(state_average= mean(percent_met_per_county))%>%
pull()
county_only_above_below_state <- county_only %>%
mutate(difference_to_state=(percent_met_per_county-state_average))%>%
mutate(across(difference_to_state, ~ round(.x, 0)))%>%
mutate(above_below = case_when(difference_to_state<0 ~ "below",
difference_to_state>0 ~ "above",
difference_to_state==0 ~ "equal"
))
joined_data <- shape %>%
clean_names(.) %>%
left_join(.,
county_only_above_below_state,
by = c("countylabe" = "county"))
#bbox_county <- joined_data %>%
#  st_bbox(.) %>%
#  tmaptools::read_osm(., type = "osm", zoom = NULL)
#tm_shape(bbox_county)+
#  tm_rgb()+
tm_shape(joined_data) +
tm_polygons(fill="above_below",
fill.scale = tm_scale_categorical(
values="brewer.bu_pu"),
fill_alpha=0.5)+
tm_compass(position = c("left", "bottom"),type = "arrow")+
tm_scalebar(position = c("left", "bottom")) +
tm_title_out("Counties above or below state avearge for science in all grades",
position=tm_pos_out("center", "top"))
setwd
'/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2'
get()
getwd
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(sf)
library(tidyverse)
library(readxl)
library(tmap)
## 2.1 Load spatial data (Washington counties)
counties <- st_read("hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.1 Load spatial data (Washington counties)
counties <- st_read("Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.1 Load spatial data (Washington counties)
counties <- st_read("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.2 Load school report card assessment data
assessment <- read_csv("hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
## 2.1 Load spatial data (Washington counties)
counties <- st_read("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.2 Load school report card assessment data
assessment <- read_csv("'/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv'")
## 2.1 Load spatial data (Washington counties)
counties <- st_read("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.2 Load school report card assessment data
assessment <- read_csv("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
## 2.3 Filter for Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
## 2.4 Convert expected & met counts to numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(`Count of Students Expected to Test`),
met = as.numeric(CountMetStandard)
)
## 3.1 Summarise total tested & total meeting standards
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
## 3.2 Align county names (uppercase both datasets)
county_summary <- county_summary %>%
mutate(County = toupper(County))
counties <- counties %>%
mutate(COUNTY = toupper(COUNTY))
## 3.3 Compute Washington state average
state_avg <- county_summary %>%
summarise(state_avg = mean(avg_percent_met, na.rm = TRUE)) %>%
pull(state_avg)
state_avg
h2_joined <- counties %>%
left_join(county_summary, by = c("COUNTY" = "County"))
## Add comparison label
h2_final <- h2_joined %>%
mutate(
comparison = case_when(
is.na(avg_percent_met)       ~ "No data",
avg_percent_met > state_avg  ~ "Above state average",
avg_percent_met < state_avg  ~ "Below state average",
TRUE                         ~ "Equal to state average"
)
)
## Inspect sample output
h2_final %>%
st_drop_geometry() %>%
select(COUNTY, avg_percent_met, comparison) %>%
head()
tmap_mode("plot")
tm_shape(h2_final) +
tm_polygons(
col = "avg_percent_met",
palette = "YlGnBu",
title = "% meeting standard"
) +
tm_layout(
title = "Science Achievement by County\nRelative to Washington State Average"
)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(sf)
library(tidyverse)
library(readxl)
library(tmap)
## 2.1 Load spatial data (Washington counties)
counties <- st_read("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Washington_Counties_with_Natural_Shoreline___washsh_area.shp")
## 2.2 Load school report card assessment data
assessment <- read_csv("/Users/piyapasotthiwat/Documents/PPS/UCL/01-CASA USS/CASA Lecture/T1/CASA0005-GIS and Science/Week2/hw2_data/Report_Card_Assessment_Data_2018-19_School_Year_20251113.csv")
## 2.3 Filter for Science, All Grades, All Students
assessment_science <- assessment %>%
filter(
TestSubject == "Science",
GradeLevel == "All Grades",
StudentGroupType == "All"
)
## 2.4 Convert expected & met counts to numeric
assessment_science <- assessment_science %>%
mutate(
expected = as.numeric(`Count of Students Expected to Test`),
met = as.numeric(CountMetStandard)
)
## 3.1 Summarise total tested & total meeting standards
county_summary <- assessment_science %>%
group_by(County) %>%
summarise(
total_expected = sum(expected, na.rm = TRUE),
total_met = sum(met, na.rm = TRUE),
avg_percent_met = (total_met / total_expected) * 100
)
## 3.2 Align county names (uppercase both datasets)
county_summary <- county_summary %>%
mutate(County = toupper(County))
counties <- counties %>%
mutate(COUNTY = toupper(COUNTY))
## 3.3 Compute Washington state average
state_avg <- county_summary %>%
summarise(state_avg = mean(avg_percent_met, na.rm = TRUE)) %>%
pull(state_avg)
state_avg
h2_joined <- counties %>%
left_join(county_summary, by = c("COUNTY" = "County"))
## Add comparison label
h2_final <- h2_joined %>%
mutate(
comparison = case_when(
is.na(avg_percent_met)       ~ "No data",
avg_percent_met > state_avg  ~ "Above state average",
avg_percent_met < state_avg  ~ "Below state average",
TRUE                         ~ "Equal to state average"
)
)
## Inspect sample output
h2_final %>%
st_drop_geometry() %>%
select(COUNTY, avg_percent_met, comparison) %>%
head()
tmap_mode("plot")
tm_shape(h2_final) +
tm_polygons(
col = "avg_percent_met",
palette = "YlGnBu",
title = "% meeting standard"
) +
tm_layout(
title = "Science Achievement by County\nRelative to Washington State Average"
)
tmap_mode("plot")
tm_shape(h2_final) +
tm_polygons(
col = "avg_percent_met",
palette = "YlGnBu",
title = "% meeting standard"
) +
tm_layout(
title = "Science Achievement by County\nRelative to Washington State Average"
)
tmap_mode("plot")
tm_shape(h2_final) +
tm_polygons(
col = "avg_percent_met",
palette = "YlGnBu",
title = "% meeting standard"
) +
tm_layout(
title = "Science Achievement by County\nRelative to Washington State Average"
)
write_csv(sankey_summary,
"public/data/sankey_summary.csv")
library(dplyr)
# 2. build sankey summary
sankey_summary <- conflict %>%
filter(!is.na(year),
!is.na(region),
!is.na(type_of_violence)) %>%
mutate(
year = as.integer(year),
type_of_violence = as.integer(type_of_violence)
) %>%
group_by(year, region, type_of_violence) %>%
summarise(event_count = n(), .groups = "drop") %>%
arrange(year, region, type_of_violence)
# 2. build sankey summary
sankey_summary <- conflict %>%
filter(!is.na(year),
!is.na(region),
!is.na(type_of_violence)) %>%
mutate(
year = as.integer(year),
type_of_violence = as.integer(type_of_violence)
) %>%
group_by(year, region, type_of_violence) %>%
summarise(event_count = n(), .groups = "drop") %>%
arrange(year, region, type_of_violence)
# 1. read raw file
conflict <- read_csv("/Users/piyapasotthiwat/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/public/data/conflict_recent.csv",
show_col_types = FALSE)
library(dplyr)
# 1. read raw file
conflict <- read_csv("/Users/piyapasotthiwat/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/public/data/conflict_recent.csv",
show_col_types = FALSE)
install.packages("readr")
install.packages("dplyr")
library(dplyr)
library(readr)
# 2. build sankey summary
sankey_summary <- conflict %>%
filter(!is.na(year),
!is.na(region),
!is.na(type_of_violence)) %>%
mutate(
year = as.integer(year),
type_of_violence = as.integer(type_of_violence)
) %>%
group_by(year, region, type_of_violence) %>%
summarise(event_count = n(), .groups = "drop") %>%
arrange(year, region, type_of_violence)
# 1. read raw file
conflict <- read_csv("/Users/piyapasotthiwat/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/public/data/conflict_recent.csv",
show_col_types = FALSE)
# 2. build sankey summary
sankey_summary <- conflict %>%
filter(!is.na(year),
!is.na(region),
!is.na(type_of_violence)) %>%
mutate(
year = as.integer(year),
type_of_violence = as.integer(type_of_violence)
) %>%
group_by(year, region, type_of_violence) %>%
summarise(event_count = n(), .groups = "drop") %>%
arrange(year, region, type_of_violence)
# 2. build sankey summary
sankey_summary <- conflict %>%
filter(!is.na(year),
!is.na(region),
!is.na(type_of_violence)) %>%
mutate(
year = as.integer(year),
type_of_violence = as.integer(type_of_violence)
) %>%
group_by(year, region, type_of_violence) %>%
summarise(event_count = n(), .groups = "drop") %>%
arrange(year, region, type_of_violence)
# 3. write small csv
dir.create("public/data", showWarnings = FALSE)
write_csv(sankey_summary,
"public/data/sankey_summary.csv")
write_csv(sankey_summary,
"public/data/sankey_summary.csv")
getwd()
setwd("/Users/piyapasotthiwat/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict")
getwd()
write_csv(sankey_summary,
"public/data/sankey_summary.csv")
cd
pwd
library(dplyr)
library(readr)
library(stringr)
})
library(dplyr)
library(readr)
library(stringr)
source("~/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/03_build_country_year_type_summary.r")
# 03_build_country_year_type_summary.R
# Build: country_year_type_summary.csv
# Output: asm1-contours-of-conflict/public/data/country_year_type_summary.csv
suppressPackageStartupMessages({
library(dplyr)
library(readr)
library(stringr)
})
# ---- A) find input file (edit if you know exact path) ----
candidates <- c(
"data_raw/ged.csv",
"data_raw/ged_events.csv",
"data_raw/ucdp_ged.csv",
"data_raw/conflict_events.csv",
"public/data/conflict_events.csv"
)
in_path <- candidates[file.exists(candidates)][1]
if (is.na(in_path)) {
stop(
"No input CSV found. Put your raw events CSV in data_raw/ and rename it (e.g. ged.csv),\n",
"or edit `candidates` in this script to point to the correct file."
)
}
list.files("data_raw")
getwd()
source("~/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/03_build_country_year_type_summary.r")
source("~/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/03_build_country_year_type_summary.r")
View(rename_if_present)
source("~/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/03_build_country_year_type_summary.r")
source("~/.active-rstudio-document")
source("~/Documents/CASA/CASA0028-DSDS/asm1-contours-of-conflict/country_year_type_share.r")
